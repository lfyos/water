uniform material_information
{
	mat4 material_map;
	float geometry_scale_x,geometry_scale_y,geometry_scale_z;
	float min_height,max_height;											
	float grass_scale,earth_scale,bottom_scale,stone_scale,cobble_scale,sandstone_scale;
}material_info;

uniform sampler2D grass,earth,bottom,stone,cobble;

in  vec4 frag_material,frag_texture;
in  vec3 frag_local_location,frag_location,frag_normal;

layout (location=0) out vec4 frag_data;

void main(void)
{	
	if(dot(target_info.clip_plane,vec4(frag_location,1.0))>0.0){
		discard;
		return;
	}
	int material_id=int(round(frag_material.w));
	if(material_id>=12)
		material_id=int(round(material_info.material_map[3][material_id-12]));
	else if(material_id>=8)
		material_id=int(round(material_info.material_map[2][material_id- 8]));
	else if(material_id>=4)
		material_id=int(round(material_info.material_map[1][material_id- 4]));
	else
		material_id=int(round(material_info.material_map[0][material_id- 0]));
	
	if(material_id==0){
		vec4 grass_color=texture(grass,material_info.grass_scale*frag_texture.xy);
		vec4 bottom_color=texture(bottom,material_info.bottom_scale*frag_texture.xy);
		
		if(frag_local_location.y<material_info.min_height)
			frag_data=bottom_color;
		else if(frag_local_location.y>material_info.max_height)
			frag_data=grass_color;
		else {
			float p;
			p =frag_local_location.y-material_info.min_height;
			p/=(material_info.max_height-material_info.min_height);
			frag_data=(1.0-p)*bottom_color+p*grass_color;
		}
		return;
	}
	if(material_id==1){
		vec4 grass_color=texture(grass,material_info.grass_scale*frag_texture.xy);
		vec4 earth_color=texture(earth,material_info.earth_scale*frag_texture.xy);
		
		if(frag_local_location.y<material_info.min_height)
			frag_data=earth_color;
		else if(frag_local_location.y>material_info.max_height)
			frag_data=grass_color;
		else {
			float p;
			p =frag_local_location.y-material_info.min_height;
			p/=(material_info.max_height-material_info.min_height);
			frag_data=(1.0-p)*earth_color+p*grass_color;
		}
		return;
	}
	if(material_id==2){
		frag_data=texture(cobble,	material_info.cobble_scale*frag_texture.xy);
		return;
	}
	if(material_id==3){
		frag_data=texture(stone,	material_info.stone_scale*frag_texture.xy);
		return;
	}
	frag_data=vec4(1.0,0.0,0.0,1.0);
	return;
}