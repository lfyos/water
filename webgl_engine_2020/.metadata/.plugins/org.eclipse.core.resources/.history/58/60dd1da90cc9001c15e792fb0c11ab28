uniform mat4 model_matrix;
uniform vec4 par;

in vec4 vertex_location,vertex_material,vertex_id;
out vec4 frag_id,frag_color;

void main(void)
{
	gl_PointSize=32.0;
	
	mat4 projection_matrix=
			(target_info.projection_type_flag>0)
				?target_info.other_projection_matrix
				:target_info.projection_matrix;
	
	frag_id			=vertex_id;
	
	frag_color		=vec4(0.25,0.25,0.25,1.0);
	gl_Position=model_matrix*vec4(0.0,0.0,par.x,1.0);
	gl_Position=vec4(vertex_location.xyz*par.y+gl_Position.xyz/gl_Position.w,1.0);
	gl_Position=projection_matrix*gl_Position;

	if(frag_id.w>0.5){
		frag_color=vec4(0.8,0.8,0.8,1.0);
		int my_component_id=int(round(par.w));
		int my_body_id=int(round(vertex_id.x));
		int my_face_id=int(round(vertex_id.y));
		
		if(system_info.pickup_component_id==my_component_id)
			if(system_info.pickup_body_id==my_body_id)
				if(system_info.pickup_face_id==my_face_id){
					frag_color=vec4(1.0,0.0,0.0,1.0);
					gl_Position.z=-1.0;
				}
	}
}
