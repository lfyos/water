uniform vec4 par;

in vec4 frag_id,frag_color;
layout (location = 0) out vec4 frag_data[4];

void main(void)
{
	switch(pass_info.method_id){
	case 0:
	case 4:
		frag_data[0]=vec4(0.25,0.25,0.25,1.0);
		if(frag_id.w>0.5){
			frag_data[0]=vec4(0.8,0.8,0.8,1.0);
			int my_component_id=int(round(par.w));
			int my_body_id=int(round(frag_id.x));
			int my_face_id=int(round(frag_id.y));
			
			if(system_info.pickup_component_id==my_component_id)
				if(system_info.pickup_body_id==my_body_id)
					if(system_info.pickup_face_id==my_face_id){
						frag_color=vec4(1.0,0.0,0.0,1.0);
						gl_Position.z=-1.0;
					}
		}
	
	
		if(int(round(frag_id.w))!=2)
				frag_data[0]=frag_color;
		else if(((gl_PointCoord.x-0.5)*(gl_PointCoord.x-0.5)+(gl_PointCoord.y-0.5)*(gl_PointCoord.y-0.5))>0.25)
				discard;
		else if(int(round(frag_id.z))!=0)
				discard;
		else
				frag_data[0]=vec4(1.0,0.0,0.0,1.0);
		return;
	case 1:
		frag_data[0]=code_integer(component_id);
		frag_data[1]=code_integer(body_id);
		frag_data[2]=code_integer(face_id);
		frag_data[3]=code_integer(vertex_id);
		return;
	}
	discard;
	return;
}