package kernel_part;

import java.io.File;
import java.io.FileWriter;

import kernel_engine.scene_parameter;
import kernel_engine.system_parameter;
import kernel_file_manager.file_reader;
import kernel_file_manager.file_directory;
import kernel_interface.client_process_bar;

public class part_container_for_delete_part_file extends part_container
{
	public void delete_part_file(client_process_bar cpb,
			system_parameter system_par,scene_parameter scene_par)
	{
		if(cpb!=null)
			cpb.set_process_bar(true, "delete_part_file","", 0,1);
		
		int number=0;
		part_link_list pll=get_part_list();
		for(part_link_list p=pll;p!=null;p=p.next)
			number++;
		if(number<=0)
			number=1;
		
		if(cpb!=null)
			cpb.set_process_bar(true, "delete_part_file","", 0,number);
		
		for(int i=0;pll!=null;pll=pll.next,i++) {
			if(cpb!=null)
				cpb.set_process_bar(false, "delete_part_file","",i,number);
			
			if(pll.p.part_par==null)
				continue;
			
			String clear_file_name_array[]=new String[]
			{
				pll.p.mesh_file_name,
				pll.p.material_file_name,
				pll.p.description_file_name,
				pll.p.audio_file_name,
				pll.p.mesh_file_name+".face",
				pll.p.mesh_file_name+".face.gzip",
				pll.p.mesh_file_name+".edge",
				pll.p.mesh_file_name+".edge.gzip"
			};

			File f;
			for(int j=0,nj=clear_file_name_array.length;j<nj;j++) {
				if(pll.p.part_par.clear_model_file_flag[j])
					if(clear_file_name_array[j]!=null){
						String file_name=pll.p.directory_name+file_reader.separator(clear_file_name_array[j]);
						if((f=new File(file_name)).exists())
							f.delete();
					}
			}
			if(pll.p.part_par.clear_buffer_head_file_flag){
				String part_temporary_file_directory=file_directory.part_file_directory(pll.p,system_par,scene_par);
				if((f=new File(part_temporary_file_directory+"mesh.head.gzip_text")).exists())
					f.delete();
				if(scene_par!=null)
					if(pll.p.part_type_id==2)
						if((f=new File(part_temporary_file_directory+"mesh.boftal")).exists()){
							long t=f.lastModified();
							try{
								new FileWriter(f).close();
							}catch(Exception e) {
								;
							}
							f.setLastModified(t);
						}
			}
		}
		if(cpb!=null)
			cpb.set_process_bar(false, "delete_part_file", number,number);
	}
}
